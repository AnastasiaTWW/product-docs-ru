[whitelist-scanner-addresses]: #добавьте-ip-адреса-сканера-валарм-в-белый-список

# Рекомендации по управлению модулем активной проверки атак

## Что такое модуль активной проверки атак?

Валарм использует несколько [методов для обнаружения уязвимостей](../about-wallarm-waf/detecting-vulnerabilities.md), один из них — **Активная проверка атак**.

Модуль активной проверки атак позволяет использовать атаки, отправленные злоумышленником, как инструмент для тестирования ваших приложений и API на наличие активных уязвимостей. Для этого модуль отправляет запросы с данными из реального трафика на адреса ваших приложений и анализирует ответ приложения. Если ответ содержит признаки активной уязвимости, модуль регистрирует соответствующую уязвимость и инцидент безопасности.

По умолчанию модуль активной проверки атак выключен. Чтобы включить его, ознакомьтесь с [методом управления модулем](#изучите-метод-управления-модулем-активной-проверки-атак).

## Как работает модуль активной проверки атак?

--8<-- "../include/how-attack-rechecker-works.md"

## Потенциальные риски использования модуля активной проверки атак

* Легитимные запросы, распознанные WAF-нодой как атака ([ложные срабатывания](../about-wallarm-waf/protecting-against-attacks.md#ложные-срабатывания)), также воспроизводятся модулем активной проверки атак. Если запросы меняют поведение приложения и в них переданы авторизационные данные, модуль активной проверки атак может выполнить нежелательные операции с приложением. Например: при активной проверке авторизованного запроса для создания нового объекта в приложении, модуль может создать набор нежелательных объектов в приложении.

    Чтобы минимизировать описанный риск, модуль активной проверки атак автоматически вырезает следующие HTTP-заголовки из запросов:

    * `Cookie`
    * `Authorization: Basic`
    * `Viewstate`
* Если в приложении используется нестандартный способ авторизации запросов или авторизация запросов не требуется, модуль активной проверки атак может воспроизвести любой запрос из трафика 100 и более раз и вызвать непредвиденное поведение системы. Например: повторить 100 и более транзакций или заказов. Чтобы минимизировать описанный риск, мы рекомендуем использовать [тестовую или staging-среду](#опционально-настройте-замену-элементов-запроса-для-активной-проверки) для активной проверки атак и [маскировать нестандартные параметры авторизации](#настройте-корректную-маскировку-данных).

## Рекомендации по управлению модулем активной проверки атак

### Настройте корректную маскировку данных

В приложении могут использоваться нестандартные типы авторизации запросов, например: токен в строке запросе, нестандартный HTTP-заголовок или объект JSON в теле POST-запроса. Если в вашем приложении используется такой тип авторизации, мы рекомендуем настроить [правило для маскировки данных](../user-guides/rules/sensitive-data-rule.md). Если правило настроено, данные для авторизации запросов не будут выгружаться в Облако Валарм и не будут использоваться при активной проверке атак. Такой подход позволит минимизировать риск нанесения вреда вашему приложению.

### Изучите метод управления модулем активной проверки атак

Модуль активной проверки включается и выключается глобально для всех ваших приложений в Консоли управления Валарм → [секция **Сканер**](../user-guides/scanner/configure-scanner-modules.md). По умолчанию модуль выключен.

### Добавьте IP-адреса Сканера Валарм в белый список

Чтобы WAF-нода не блокировала атаки, которые генерирует и отправляет модуль активной проверки, необходимо добавить IP-адреса источника запросов в белый список. Модуль активной проверки атак является одним из модулей Сканера Валарм, поэтому необходимо добавить IP-адреса Сканера в белый список по инструкции:

* [Инструкция для WAF‑ноды на основе NGINX](../admin-ru/scanner-ips-whitelisting.md) (в том числе для образов AWS / GCP / Яндекс.Облака и Docker-контейнера)
* [Инструкция для Ingress-контроллера Валарм в Kubernetes](../admin-ru/configuration-guides/wallarm-ingress-controller/best-practices/whitelist-wallarm-ip-addresses.md)
* Инструкция для sidecar-контейнера Валарм, развернутного в Kubernetes с помощью [Helm charts](../admin-ru/installation-guides/kubernetes/wallarm-sidecar-container-helm.md) или [Kubernetes-манифестов](../admin-ru/installation-guides/kubernetes/wallarm-sidecar-container-manifest.md)

Активная проверка атак может работать некорректно, если IP-адреса Сканера Валарм не добавлены в белый список.

### Настройте уведомление ваших команд об инцидентах безопасности

Чтобы получать уведомления о событиях безопасности, вы можете интегрировать Валарм WAF со [сторонними мессенджерами и SIEM-системами](../user-guides/settings/integrations/integrations-intro.md), которые вы используете в работе. Например: Slack, Telegram, PagerDuty, Opsgenie и другими. Чтобы ваша команда могла оперативно отреагировать на обнаруженный инцидент безопасности, мы рекомендуем настроить отправку соответствующих уведомлений в удобную систему.

### Ознакомьтесь с действиями при отправке чувствительных данных в Облако Валарм

Если вы обнаружили, что WAF-нода отправляет в Облако Валарм ложные срабатывания с незамаскированными чувствительными данными, обратитесь в [техническую поддержку Валарм](mailto:support@wallarm.ru) для удаления запросов из хранилища Облака.

Чтобы избежать отправки чувствительных данных в будущем, настройте [правило для маскировки данных](../user-guides/rules/sensitive-data-rule.md). Данные, которые уже были отправлены в Облако, невозможно замаскировать.

### Опционально: Включите или выключите активную проверку атак для отдельных приложений

Если запросы к некоторым адресам ваших приложений изменяют работу приложения и не требуют авторизационных данных, мы рекомендует выключить активную проверку атак для таких адресов. Активная проверка может быть выключена для отдельных приложений, доменов или URL приложений.

Чтобы выключить активную проверку атак для отдельных приложений, необходимо отправить запрос в [техническую поддержку Валарм](mailto:support@wallarm.ru).

### Опционально: Настройте замену элементов запроса для активной проверки

Чтобы выполнять активную проверку атак не в боевой среде приложения, а в тестовой или staging-среде, вы можете настроить соответствующее [правило](../user-guides/rules/change-request-for-active-verification.md) для замены элементов оригинального запроса перед активной проверкой.
