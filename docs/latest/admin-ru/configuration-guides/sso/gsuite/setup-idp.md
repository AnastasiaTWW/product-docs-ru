[img-gsuite-console]:       ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-console.png
[img-gsuite-add-app]:       ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-add-app.png
[img-fetch-metadata]:       ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-fetch-metadata.png
[img-fill-in-sp-data]:      ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-fill-in-sp-data.png
[img-app-page]:             ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-app-page.png
[img-create-attr-mapping]:  ../../../../images/admin-guides/configuration-guides/sso/gsuite/gsuite-attr-mapping.png

[doc-setup-sp]:             setup-sp.md
[doc-metadata-transfer]:    metadata-transfer.md

[link-gsuite-adm-console]:  https://admin.google.com


#   Шаг 2.  Создание и настройка приложения в G Suite

!!! info "Необходимые сведения"
    В этом руководстве в качестве демонстрационных используются следующие значения:
    
    *   `WallarmApp` — для параметра **Название приложения** (в G Suite);
    *   `https://sso.online.wallarm.com/acs` — для параметра **ACS URL** (в G Suite);
    *   `https://sso.online.wallarm.com/entity-id` — для параметра **Идентификатор объекта** (в GSuite).

!!! warning "Обратите внимание"
    Убедитесь, что вместо демонстрационных значений последних двух параметров вы используете значения, [полученные ранее][doc-setup-sp].

Войдите в [консоль администратора][link-gsuite-adm-console] Google. Нажмите на блок *Приложения*.

![!Консоль G Suite][img-gsuite-console]

Далее нажмите на блок *SAML‑приложения*. Добавьте новое приложение, нажав на ссылку *Добавить сервис/приложение в домен* или на кнопку «+» внизу справа.

Нажмите кнопку *Добавить свое приложение*.

![!Добавление приложения в G Suite][img-gsuite-add-app]

Вам будут предоставлены сведения (метаданные) G Suite в качестве поставщика идентификационных данных:
*   **URL Системы единого входа**;
*   **Идентификатор объекта**;
*   **Сертификат** (X.509).

Метаданные представляют собой набор параметров, описывающих свойства поставщика идентификационных данных (подобных тем, что были сформированы для поставщика сервиса [на Шаге 1][doc-setup-sp]), необходимых для настройки SSO.

Вы можете передать их мастеру настройки SSO Валарм двумя способами:
*   Скопировать каждый параметр и скачать сертификат, а затем вставить (загрузить) в соответствующие поля мастера настройки Валарм.
*   Скачать XML‑файл с метаданными и загрузить его на стороне Валарм.

Сохраните метаданные любым удобным для вас способом и перейдите на следующий этап настройки приложения, нажав кнопку Далее. Ввод метаданных поставщика идентификационных данных на стороне Валарм будет описан [на Шаге 3][doc-metadata-transfer].

![!Выгрузка метаданных][img-fetch-metadata]

На следующем этапе настройки приложения вам необходимо предоставить метаданные поставщика сервиса (Валарм). Поля, обязательные для заполнения:
*   **URL ACS** — соответствует параметру **Assertion Consumer Service URL**, сгенерированному на стороне Валарм;
*   **Идентификатор объекта** — соответствует параметру **Wallarm Entity ID**, сгенерированному на стороне Валарм.

Остальные параметры заполните при необходимости. Нажмите кнопку *Далее*.

![!Заполнение сведений о поставщике услуг][img-fill-in-sp-data]

На заключительном этапе настройки приложения вам будет предложено связать атрибуты поставщика сервиса c доступными полями профиля пользователя. Валарм в качестве поставщика сервиса требует выполнить связывание атрибутов.

Нажмите кнопку *Добавить сопоставление* и привяжите атрибут `email` к полю «Основной адрес электронной почты» (поле находится в группе «Общие сведения»).

![!Связывание атрибутов][img-create-attr-mapping]

Нажмите кнопку *Готово*.

После этого во всплывающем окне вам будет сообщено, что предоставленная информация сохранена и для завершения настройки SAML SSO необходимо загрузить данные о поставщике идентификационных данных (Google) в панели администратора поставщика сервиса (Валарм). Нажмите кнопку *Ok*. 

После этого вы попадете на страницу созданного приложения. Сразу после создания приложения оно отключено для всех ваших организаций в G Suite. Чтобы активировать SSO для этого приложения, нажмите кнопку *Изменить статус сервиса*.

![!Страница приложения в G Suite][img-app-page]

Далее выберите для параметра **Статус сервиса** значение *Включено для всех* и нажмите *Сохранить*.

Теперь вы можете [продолжить настройку SSO][doc-metadata-transfer] на стороне Валарм.