# Настройка схемы резервирования

Установка WAF‑ноды в качестве обратного прокси‑сервера ([Обратный прокси‑сервер](../glossary-ru.md#обратный-проксисервер)) накладывает серьезные требования к надежности его работы. Если WAF‑нода по какой-то причине окажется неработоспособной (например, из‑за выключения питания), то нормальная работа приложения будет ограничена. Для того чтобы гарантировать высокую доступность Валарм, рекомендуется использовать одну из описанных ниже схем резервирования. При резервировании к основным WAF‑нодам добавляются еще и дополнительные — резервные WAF‑ноды, на которые в случае аварии будет автоматически переключен трафик.

## Резервирование от датацентра

Если приложение и WAF‑ноды установлены в датацентре, то нередко сам датацентр предлагает услугу «Failover IP».

## Использование VRRP или CARP 

На каждой WAF‑ноде поднимается специальный демон `keepalived` или `ucarp`, который следит за работоспособностью остальных WAF‑нод и быстро переносит IP‑адрес на работоспособную ноду. Данный подход является стандартным для обеспечения отказоустойчивости, однако его же можно использовать для балансировки трафика, подняв по failover-IP на каждой WAF‑ноде и распределяя между ними трафик при помощи DNS‑балансировки.

!!! info "Работа с NGINX Plus"
    Валарм может работать на базе коммерческого [NGINX Plus](https://www.nginx.com/products/nginx/), у которого есть специальная обвязка для VRRP.
    
    В большинстве дистрибутивов Linux, включая RHEL, Debian и другие, есть специальные пакеты, позволяющие запустить этот билд самостоятельно.

    Инструкция по установке Валарм с использованием NGINX Plus доступна на странице [«Установка с использованием NGINX Plus»](../waf-installation/nginx-plus.md).

## Аппаратный L3‑ или L4‑балансировщик

Layer 3‑ или Layer 4‑балансировшик хорошо решает задачи балансировки и отказоустойчивости. В самом простом варианте реализуется только балансировка.

## DNS‑балансировка

В настройках DNS прописывается несколько IP‑адресов. Такая схема в основном используется для балансировки нагрузки. С определенными оговорками можно использовать и для обеспечения отказоустойчивости.
