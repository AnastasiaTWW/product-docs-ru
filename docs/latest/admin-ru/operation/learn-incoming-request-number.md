# Определение количества запросов к приложению за месяц

В большинстве случаев, стоимость использования продукта Валарм WAF зависит от количества запросов, обработанных установлеными WAF‑нодами. Эта инструкция описывает способы для определения среднего количества запросов, которые обрабатывает ваше приложение.

## Доступ к количеству запросов

Обычно, следующие команды имеют доступ к данным о количестве запросов:

* DevOps
* Технический отдел
* Отдел по управлению облачными сервисами
* Отдел по управлению платформами
* DevSecOps
* Системные администраторы
* Администраторы приложений
* Отдел по управлению сетями

## Методы определения количества запросов

Для получения среднего количества запросов, обработанных приложением за месяц, могут применяться следующие способы:

* Клиенты AWS с настроенным балансировщиком нагрузки ELB или ALB могут использовать AWS‑метрики балансировщика нагрузки.

    ![!Пример мониторинга AWS](../../images/operation/aws-requests-example.png)

    Например: если среднее количество запросов в минуту равно 350 и в месяце 730 часов, количество запросов за месяц можно определить по формуле `350 * 60 * 730 = 15330000`.

* Клиенты GCP с настроенным HTTP‑балансировщиком нагрузки могут использовать метрику **https/request_count**. Метрика недоступна для балансировщика NLB.
* Пользователи Microsoft IIS могут получить среднее количество запросов в секунду из метрики **Requests Per Sec** для одного или нескольких IIS‑серверов. Для расчета количества запросов за месяц, умножьте полученное значение на среднее количество секунд в месяце: `730 * 3600`.
* Пользователи сервисов по мониторингу приложений (New Relic, Datadog, AppDynamics, SignalFX и других) могут найти данные о количестве запросов в консоли сервиса. При просмотре и анализе данных убедитесь, что вы получили агрегированное значение по всем необходимым серверам.
* Пользователи облачных сервисов по мониторингу приложений (Datadog, AWS CloudWatch и других) и внутренних систем мониторинга (Prometheus, Nagios и других) могут определить количество обработанных запросов по текущим метрикам.
* Пользователи могут проанализировать количество записей в логах балансировщика нагрузки или веб‑сервера. Например, логи NGINX ротируются на веб‑сервере 1 раз в день и в лог‑файле 653525 записей:

    ```bash
    cd /var/log/nginx/
    zcat access.log.2.gz |wc -l
    # 653525
    ```

    * Количество запросов, обработанных за месяц: `653525 * 30 = 19605750`.
    * Если известно общее количество веб‑серверов, можно определить среднее количество запросов, обработанных всем приложением.

* В веб‑приложениях с настроенным сервисом Google Analytics или другим сервисом мониторинга, количество запросов может быть получено из метрик, собранных сервисом мониторинга.