# Политика версионирования WAF‑ноды

Политика описывает способ версионирования артефактов WAF‑ноды Валарм для разных платформ: пакеты Linux, Docker‑контейнеры, чарты Helm и т.д. Вы можете использовать этот документ при выборе версии для первой установки и для планирования обновления установленных пакетов.

!!! info "Артефакт"
    Артефакт — результат разработки, который используется для установки WAF‑ноды на платформу. Например: Linux‑пакеты, модули Kong API, Docker‑контейнеры и другие.

## Список версий

| Версия WAF‑ноды | Дата выхода   | Окончание поддержки |
|-----------------|---------------|---------------------|
| 2.10 и ниже     |               | Май 2019            |
| 2.12            | Март 2019     | Январь 2021         |
| 2.14            | Февраль 2020  | Май 2021            |
| 2.16            | Октябрь 2020  |                     |
| 2.18            | Февраль 2021  |                     |

## Формат версий

Версии артефактов WAF‑ноды имеют следующий формат:

```bash
<MAJOR_VERSION>.<MINOR_VERSION>.<PATCH_VERSION>[-<BUILD_NUMBER>]
```

| Параметр                | Описание                                                                                                                                                                                                                                                                                                         | Средняя частота обновления           |
|--------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
| `<MAJOR_VERSION>`              | Мажорная версия WAF‑ноды:<ul><li>Крупная переработка компонентов</li><li>Несовместимые изменения</li></ul>Начальное значение — `2`. Значение увеличивается на 1, например: `2.14.0`, `3.1.0`.                                                                                                                    | Обновление не ожидается              |
| `<MINOR_VERSION>`              | Минорная версия WAF‑ноды:<ul><li>Новые возможности продукта</li><li>Исправленные крупные ошибки</li><li>Другие совместимые изменения</li></ul>Значение увеличивается на 2, например: `2.12`, `2.14`.                                                                                                             | 1 раз в квартал                         |
| `<PATCH_VERSION>`              | Версия патча WAF‑ноды:<ul><li>Исправленные мелкие ошибки</li><li>Новые возможности, добавленные по специальному запросу</li></ul>Начальное значение — `0`. Значение увеличивается на 1, например: `2.14.0`, `2.14.1`.                                                                                                                                     | 1 раз в месяц                        |
| `<BUILD_NUMBER>` (опционально) | Версия сборки WAF‑ноды. Присваивается платформой для сборки пакетов автоматически. Если пакеты собираются вручную, значение не присваивается.<br />Значение увеличивается на 1, например: `2.14.0-1`, `2.14.0-2`. Если первая сборка завершилась с ошибкой, сборка выполняется еще раз и значение увеличивается. | По мере обновления `<PATCH_VERSION>` |

В зависимости от [формы установки WAF‑ноды](../admin-ru/supported-platforms.md), мы рекомендуем использовать разный формат версии пакетов и образов при скачивании:

* `<MAJOR_VERSION>.<MINOR_VERSION>` при скачивании Linux‑пакетов
* `<MAJOR_VERSION>.<MINOR_VERSION>.<PATCH_VERSION>[-<BUILD_NUMBER>]` при скачивании Docker‑образов, облачных образов и Helm‑чарта

    При скачивании Docker‑образов Валарм, вы также можете указать версию WAF‑ноды в формате `<MAJOR_VERSION>.<MINOR_VERSION>`. Установленная минорная версия будет содержать изменения из последней доступной версии патча. Поведение WAF‑ноды может меняться с каждым запуском одной и той же версии образа в формате `<MAJOR_VERSION>.<MINOR_VERSION>`, так как при следующем запуске минорная версия может содержать изменения из последней доступной версии патча, которые не были доступны при предыдущем запуске образа.

Версии пакетов WAF‑ноды в рамках одного артефакта могут отличаться. Например, обновление может требоваться только для одного пакета, в таком случае для остальных пакетов сохраняется предыдущая версия.

## Поддержка версий

Валарм поддерживает 3 последние минорные версии WAF‑ноды следующим образом:

* Последняя версия: исправление ошибок. Возможно добавление новых возможностей после соответствующего запроса.
* Предыдущая версия: исправление ошибок.
* Третья доступная версия: исправление ошибок в течение 3 месяцев после релиза последней версии. Через 3 месяца поддержка прекращается.

При первой установке WAF‑ноды, рекомендуется использовать последнюю доступную версию. При установке дополнительной WAF‑ноды в окружение с уже установленными WAF‑нодами, рекомендуется использовать одинаковую минорную версию во всех установках для полной совместимости.

## Обновление версии

Предполагается, что вы используете последнюю доступную версию WAF‑ноды при установке, обновлении или настройке продукта. Инструкции для WAF‑ноды описывают команды, которые автоматически устанавливают последнюю доступную версию патча и сборки.

### Уведомление о новой версии

Валарм публикует информацию о новой минорной версии в следующих источниках:

* Публичная документация
* [Новостной портал](https://changelog.wallarm.ru/)
* Консоль управления Валарм

    ![!Уведомление о новой версии в Консоли управления](../images/updating-migrating/wallarm-console-new-version-notification.png)

Также, информация о новых доступных минорных версиях и версиях патчей отображается в Консоли управления Валарм → **Ноды** для обычных нод. Рядом с каждым пакетом отображается статус **Обновлено** или версии доступных обновлений. Например, если установлены пакеты последних версий:

![!Карточка ноды](../images/user-guides/nodes/view-regular-node-comp-vers.png)

### Процедура обновления

Вместе с выпуском новой минорной версии WAF‑ноды, публикуются инструкции по установке новой версии и по обновлению существующих артефактов. Способы обновления артефактов различаются. Чтобы обновить версии артефактов, используйте соответствующие инструкции из раздела **Обновление и миграция**.

После обновления до новой минорной версии или версии патча, все предыдущие настройки WAF‑ноды сохранятся и применятся к новой версии.
