[al-sqli]:              ../../attacks-vulns-list.md#sqlинъекция-sql-injection       
[al-xss]:               ../../attacks-vulns-list.md#межсайтовый-скриптинг-англ-cross-site-scripting-xss                
[al-rce]:               ../../attacks-vulns-list.md#удаленное-выполнение-кода-англ-remote-code-execution-rce     
[al-bruteforce]:        ../../attacks-vulns-list.md#брутфорс-англ-bruteforce-attack 
[al-path-traversal]:    ../../attacks-vulns-list.md#path-traversal  
[al-crlf]:              ../../attacks-vulns-list.md#crlf-инъекция-англ-crlf-injection     
[al-open-redirect]:     ../../attacks-vulns-list.md#небезопасное-перенаправление-англ-open-redirect   
[al-nosqli]:            ../../attacks-vulns-list.md#nosqlинъекция-англ-nosql-injection    
[al-logic-bomb]:        ../../attacks-vulns-list.md#логическая-бомба-англ-logic-bomb    
[al-xxe]:               ../../attacks-vulns-list.md#атака-на-внешние-xml-сущности-xml-external-entity-xxe    
[al-virtual-patch]:     ../../attacks-vulns-list.md#виртуальный-патч-англ-virtual-patch   
[al-forced-browsing]:   ../../attacks-vulns-list.md#принудительный-просмотр-ресурсов-вебприложения-англ-forced-browsing    
[al-ldapi]:             ../../attacks-vulns-list.md#ldap-инъекция-англ-ldap-injection    
[al-port-scanner]:      ../../attacks-vulns-list.md#изучение-ресурса-сторонним-сканером  
[al-infoleak]:          ../../attacks-vulns-list.md#раскрытие-информации-англ-information-exposure
[al-overlimit]:         ../../attacks-vulns-list.md#превышение-лимита-вычислительных-ресурсов

# Использование поиска и фильтров

Валарм предоставляет несколько удобных механизмов для поиска обнаруженных атак, инцидентов и уязвимостей. В секции **События** в Консоли управления Валарм доступны следующие механизмы поиска:

* **Фильтры** для выбора критериев поиска
* **Поисковая строка** для ввода поискового запроса с использованием атрибутов и модификаторов, приближенных к человеческому языку

Значения, установленные в фильтрах, автоматически дублируются в поисковой строке. Значения, указанные в поисковой строке, автоматически дублируются в фильтрах.

Вы можете сохранить любой поисковый запрос или комбинацию фильтров как шаблон, используя опцию **Сохранить шаблон поиска**.

## Фильтры

Доступные фильтры поиска представлены в Консоли управления Валарм в следующих формах:

* Панель фильтров, которая разворачивается и сворачивается по кнопке **Фильтр**
* Быстрые фильтры для исключения или отображения только событий с конкретным значением параметра

![!Фильтры в Консоли управления](../../images/user-guides/search-and-filters/filters.png)

Если в фильтрах заданы значения для разных параметров, результат будет удовлетворять всем условиям. Если указано несколько значений для одного параметра, результат будет удовлетворять любому из значений.

## Поисковая строка

Поисковая строка принимает поисковые запросы с атрибутами и модификаторами, приближенными к человеческому языку, поэтому запрос можно набрать почти интуитивно. Например:

* `attacks xss`&nbsp;— поиск всех XSS-атак ([межсайтовый скриптинг][al-xss])
* `attacks today`&nbsp;— поиск любых атак за сегодня
* `vulns sqli`: поиск уязвимостей к атакам типа [внедрение SQL‑кода][al-sqli]
* `vulns 11/01/2020 - 11/10/2020`&nbsp;— поиск уязвимостей за указанный период
* `xss 14/12/2020`&nbsp;— поиск всех уязвимостей, подозрений, атак и инцидентов межсайтового скриптинга на 14 декабря 2020 года
* `p:xss 14/12/2020`&nbsp;— поиск всех уязвимостей, подозрений, атак и инцидентов типа [межсайтовый скриптинг][al-xss] за 14 декабря 2020 года
* `attacks 9-12/2020`&nbsp;— поиск всех атак с сентября по декабрь 2020 года
* `rce /catalog/import.php`: поиск всех [RCE-атак][al-rce], инцидентов и уязвимостей по скрипту `/catalog/import.php` за последний день

Если в поисковой строке указаны значения для разных параметров, результат будет удовлетворять всем условиям. Если указаны несколько значений для одного параметра, результат будет удовлетворять любому из них.

!!! info "Поиск по атрибуту со значением НЕ"
    Чтобы задать исключающее значение атрибута поиска, добавьте `!` перед атрибутом. Например: `attacks !ip:111.111.111.111` вернет атаки, отправленные с любого IP‑адреса, кроме `111.111.111.111`.

Ниже приведен набор атрибутов и модификаторов, которые могут быть использованы в поисковых запросах.

### Поиск по типу объекта

Укажите в строке поиска:

* `attack`, `attacks`&nbsp;— чтобы искать только атаки, которые не направлены на известные уязвимости
* `incident`, `incidents`&nbsp;— чтобы искать только инциденты (атаки, эксплуатирующие известную уязвимость)
* `vuln`, `vulns`, `vulnerability`, `vulnerabilities`&nbsp;— чтобы искать только уязвимости

### Поиск по типу атаки или уязвимости

Укажите в строке поиска:

* `sqli`&nbsp;— чтобы искать [внедрения SQL‑кода][al-sqli];
* `xss`&nbsp;— чтобы искать [межсайтовый скриптинг][al-xss];
* `rce`&nbsp;— чтобы искать [удаленное выполнение кода][al-rce];
* `brute`&nbsp;— чтобы искать [атаки перебора][al-bruteforce];
* `ptrav`&nbsp;— чтобы искать атаки типа [path traversal][al-path-traversal];
* `crlf`&nbsp;— чтобы искать [внедрения символов CRLF][al-crlf];
* `redir`&nbsp;— чтобы искать уязвимости [открытых переадресаций][al-open-redirect];
* `nosqli`&nbsp;— чтобы искать [внедрения NoSQL‑кода][al-nosqli];
* `logic_bomb`&nbsp;— чтобы искать [логические бомбы][al-logic-bomb];
* `overlimit_res`&nbsp;— чтобы искать атаки, направленные на [превышение лимита вычислительных ресурсов][al-overlimit];
* `xxe`&nbsp;— чтобы искать [внешние XML‑сущности][al-xxe];
* `vpatch`&nbsp;— чтобы искать [виртуальные патчи][al-virtual-patch];
* `dirbust`&nbsp;— чтобы искать атаки типа [forced browsing][al-forced-browsing];
* `ldapi`&nbsp;— чтобы искать [внедрения LDAP-кода][al-ldapi];
* `scanner`&nbsp;— чтобы искать атаки/уязвимости [сканеров портов][al-port-scanner];
* `infoleak`&nbsp;— чтобы искать [атаки/уязвимости раскрытия информации][al-infoleak].

Название уязвимости может быть указано как строчными, так и заглавными буквами.
Т.е. `SQLI`, `sqli` и `SQLi` будут восприняты одинаково.

### Поиск по цели атаки или уязвимости

Укажите в строке поиска:

* `client`&nbsp;— чтобы искать атаки/уязвимости пользовательских данных;
* `database`&nbsp;— чтобы искать атаки/уязвимости базы данных;
* `server`&nbsp;— чтобы искать атаки/уязвимости сервера приложений.

### Поиск по уровню опасности

Укажите в строке поиска:

* `low`&nbsp;— низкий уровень опасности;
* `medium`&nbsp;— средний уровень опасности;
* `high`&nbsp;— высокий уровень опасности.

### Поиск уязвимостей по идентификатору

Для поиска уязвимостей по идентификатору можно указывать его в одном из двух вариантов:

* полностью: `WLRM-ABCD-X0123`;
* сокращенно: `X0123`.

### Поиск по статусу уязвимости

Укажите в строке поиска:

* `open`&nbsp;— актуальная уязвимость
* `closed`&nbsp;— исправленная уязвимость

### Поиск по времени события

Задайте в строке поиска временной интервал. Если временной интервал не задан, отображаются события за последние сутки.

Вы можете использовать несколько способов, чтобы задать временной интервал:

* Дата: `10/11/2020 - 14/11/2020`
* Дата и время (всегда без секунд): `10/11/2020 11:11`, `11:30-12:22`, `10/11/2020 11:12 - 14/11/2020 12:14`
* Дата и время относительно определенного момента времени, например: `>10/01/20`
* Строковые алиасы:
    * `yesterday` для вчерашней даты
    * `today` для сегодняшней даты
    * `last <unit>` для периода с начала полного прошедшего unit'а до текущей даты

        `<unit>` может быть: `week`, `month`, `year` или количество таких unit'ов. Например: `last week`, `last 3 month` или `last 3 months`.

    * `this <unit>` для текущего unit'а

        `<unit>` может быть: `week`, `month`, `year`. Например: `this week` вернет события за понедельник, вторник и среду на текущей неделе, если сегодня — среда.

Дата указывается в формате ДД/ММ/ГГГГ, где ММ — полный или сокращенный номер месяца: `10/01/2020` или `10/1/2020`. Если ГГГГ не указан в дате, используется текущий год. Время указывается в 24‑часовом формате, например: `13:00`.

### Поиск по IP‑адресу

Для поиска по IP‑адресу используется префикс `ip:`, после которого вы можете задать:
*   Конкретный IP‑адрес, например `192.168.0.1` — в этом случае будут найдены все атаки и инциденты, для которых адрес источника атаки соответствует этому IP‑адресу.
*   Выражение, описывающее диапазон IP‑адресов, для которого необходимо произвести поиск. 
*   Общее число IP‑адресов, относящихся к атаке или инциденту.

#### Поиск по диапазону IP‑адресов

Чтобы задать требуемый диапазон IP‑адресов, вы можете использовать:
*   Явный диапазон значений IP‑адресов:
    *   `192.168.0.0-192.168.63.255`;
    *   `10.0.0.0-10.255.255.255`.
*   Часть IP‑адреса:
    *   `192.168.` — эквивалентно `192.168.0.0-192.168.255.255`. Допускается избыточный формат записи с модификатором `*` — `192.168.*`.
    *   `192.168.0.` — эквивалентно `192.168.0.0-192.168.0.255`.
*   IP‑адрес или его часть с диапазоном значений внутри последнего октета в выражении:
    *   `192.168.1.0-255` — эквивалентно `192.168.1.0-192.168.1.255`;
    *   `192.168.0-255` — эквивалентно `192.168.0.0-192.168.255.255`.
        !!! warning "Важно"
            При использовании диапазона значений внутри октета **точка в конце не ставится**.
*   Префиксы подсетей ([CIDR-нотация](https://tools.ietf.org/html/rfc4632)):
    *   `192.168.1.0/24` — эквивалентно `192.168.1.0-192.168.1.255`;
    *   `192.168.0.0/17` — эквивалентно `192.168.0.1-192.168.127.255`.

!!! info "Обратите внимание"
    Вы можете комбинировать перечисленные выше способы поиска по IP‑адресу. Для этого перечислите все необходимые диапазоны с префиксом `ip:` по отдельности. 
    
    **Пример:** `ip:192.168.0.0/24 ip:10.10. ip:10.0.10.0-128`

#### Поиск по числу IP‑адресов
Также есть возможность искать по общему числу IP‑адресов, связанных с атаками и инцидентами:
*   `ip:1000+ last month` — поиск атак и инцидентов за последний месяц, для которых число уникальных IP‑адресов более 1000 
(эквивалентно запросу `attacks incidents ip:1000+ last month`).
*   `xss ip:100+` — поиск всех атак и инцидентов межсайтового скриптинга. 
    Если меньше 100 разных IP‑адресов было зарегистрировано как атакующие с этим типом атаки, результат поиска будет пустым.
*   `xss p:id ip:100+` — выполнит поиск всех атак и инцидентов типа XSS для HTTP‑параметра `id(?id=aaa)` и вернет результат, 
    только если число разных IP‑адресов превышает 100.

### Поиск по дата‑центру IP‑адреса

Для поиска по дата‑центру, которому принадлежит IP‑адрес, с которого отправлены атаки, используйте префикс `source:`.

Атрибут принимает следующие значения:

* `tor` для узлов Tor
* `proxy` для публичного прокси‑сервера или веб‑сервера
* `vpn` для сети VPN
* `aws` для Amazon
* `azure` для Microsoft Azure
* `gce` для Google Cloud Platform

### Поиск по стране регистрации IP‑адреса

Для поиска по стране, в которой зарегистрирован IP‑адрес, с которого отправлены атаки, используйте префикс `country:`.

Название страны должно быть передано в соответствии со стадартом [ISO 3166-1](https://en.wikipedia.org/wiki/ISO_3166-1) строчными или заглавными буквами. Например: `country:CN` или `country:cn` для атак, отправленных из Китая.

### Поиск по статусу ответа сервера

Для поиска по статусу ответа сервера укажите префикс `statuscode:`.

Статус для поиска может быть задан в виде:

* числа от 100 до 999;
* диапазона «N−M», где N и M — это числа от 100 до 999;
* диапазона «N+» и «N-», где N — это число от 100 до 999.

### Поиск по размеру ответа сервера

Для поиска по размеру ответа сервера укажите в строке поиска префикс `s:` или `size:`.

В качестве параметра поиска можно указать любое целое число. Числа больше 999 могут задаваться без префикса. Можно указывать диапазоны «N-M», «N+» и «N-». Если в диапазоне числа больше 999, то префикс также можно не указывать.

### Поиск по методу HTTP‑запроса

Для поиска по методу HTTP‑запроса укажите префикс `method:`.

`GET`, `POST`, `PUT`, `DELETE` и `OPTIONS` в качестве параметра поиска с учетом регистра могут быть указаны без префикса. Для указания всех остальных значений необходимо использовать префикс.

### Поиск по количеству хитов в атаке или инциденте

Для поиска атак или инцидентов по количеству хитов, используйте префикс `N:`.

Например, вы можете найти атаки с более чем 100 хитами по запросу `attacks N:>100` или атаки с менее чем 10 хитами по запросу `attacks N:<10`.

### Поиск по домену

Для поиска по домену укажите префиксы `d:` или `domain:`.

Без префикса обрабатывается любая строка, которая может быть доменом второго и более уровня. С префиксом может быть указана любая строка.

В домене можно использовать маски. Символ `*` заменяет любое количество символов, символ `?` заменяет любой один символ.

### Поиск по пути

Для поиска по пути укажите префикс `u:` или `url:`.

Без префикса обрабатываются строки, которые начинаются с `/`. С префиксом может быть указана любая строка.

### Поиск по приложению

Для поиска по приложению, на адрес которого отправлены атаки или в котором обнаружены уязвимости, используйте префикс `pool:`.

В качестве значения атрибута используется название приложения, заданное на вкладке **Приложения** в секции **Настройки**. Например: `pool:'Example application'`.

### Поиск по параметру

Для поиска по параметру укажите префикс `p:`, `param:` или `parameter:`, а также суффикс `=`.

Например, если необходимо найти атаки на параметр `xss`, а не [xss-атаки][al-xss] (например, найти атаку типа [SQL‑injection][al-sqli] в GET-параметре `xss`), то в поисковой строке следует ввести `attacks p:xss`.

Строка, которая начинается не с `/` и заканчивается на `=` рассматривается как параметр (при этом завершающий `=` в значение не входит). С префиксом может быть указана любая строка.

### Поиск аномалий в атаках

Для поиска аномалий в атаках укажите префикс `a:` или
`anomaly:`.

Поддерживаемые параметры для поиска аномалий:

* `size`;
* `statuscode`;
* `time`;
* `stamps`;
* `impression`;
* `vector`.

Пример:

Поиск `attacks sqli a:size` найдет все атаки вида SQL‑инъекция, где в запросах были аномалии размера ответа.

### Поиск по идентификатору запроса

Для поиска атак и инцидентов по идентификатору запроса укажите префикс `request_id`.
Параметр `request_id` имеет значение вида `a79199bcea606040cc79f913325401fb`.
Далее в примерах используется условное обозначение `<requestId>`.

Примеры использования:
*   `attacks incidents request_id:<requestId>` – поиск атаки или инцидента с `request_id` равному `<requestId>`;
*   `attacks incidents !request_id:<requestId>` – поиск атак или инцидентов с `request_id` не равному `<requestId>`;
*   `attacks incidents request_id` – поиск атак или инцидентов с любым `request_id`;
*   `attacks incidents !request_id` – поиск атак или инцидентов с отсутствующим `request_id`.
