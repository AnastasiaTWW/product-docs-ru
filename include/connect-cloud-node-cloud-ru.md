[link-wl-console-users]:        https://my.wallarm.com/settings/users
[img-wl-console-users]:         ../images/check-users.png

[anchor-token]:                 #подключение-с-использованием-токена-wafноды
[anchor-credentials]:           #подключение-с-использованием-логина-и-пароля-вашей-учетной-записи-в-облаке


WAF‑нода в процессе работы взаимодействует с облаком Валарм.

Существует два способа подключения WAF‑ноды к облаку:
* [Подключение с использованием токена WAF‑ноды][anchor-token];
* [Подключение с использованием логина и пароля вашей учетной записи в облаке][anchor-credentials].


!!! info "Требуемые права доступа"
    Убедитесь, что роль вашего пользователя в Консоли управления Валарм — **Администратор** или **Деплой** и для пользователя отключена двухфакторная аутентификация.

    Для этого перейдите к списку пользователей в [RU‑облаке](https://my.wallarm.ru/settings/users) или [EU‑облаке](https://my.wallarm.com/settings/users) и проверьте столбцы **Роль** и **Auth**:

    ![!Список пользователей в консоли Валарм][img-wl-console-users]

#### Подключение с использованием токена WAF‑ноды

Для того, чтобы подключить WAF‑ноду к облаку с использованием токена, выполните следующие действия:

1. На вкладке *Ноды* веб‑интерфейса Валарм создайте новую WAF‑ноду:
    1. Нажмите на кнопку *Создать ноду*.
    2. В появившейся форме введите имя WAF‑ноды и выберите вариант установки *Облако* из выпадающего списка.
    3. Нажмите на кнопку *Создать*.
2. В появившемся окне нажмите на кнопку *Скопировать* справа от поля с токеном, чтобы добавить токен созданной WAF‑ноды в ваш буфер обмена.
3. На виртуальной машине с WAF‑нодой запустите скрипт `addcloudnode`:
    
    === "EU‑облако"
        ``` bash
        sudo /usr/share/wallarm-common/addcloudnode
        ```
    === "RU‑облако"
        ``` bash
        sudo /usr/share/wallarm-common/addcloudnode -H api.wallarm.ru
        ```
    
4. Вставьте токен WAF‑ноды из буфера обмена.

Теперь WAF‑нода будет синхронизироваться с облаком каждые 10‑15 минут в соответствии с конфигурацией синхронизации по умолчанию.

!!! info "Конфигурация синхронизации WAF‑ноды с Облаком"
    После запуска скрипта `addcloudnode` будет создан файл `/etc/wallarm/syncnode`, содержащий переменные окружения и их значения. Вы можете конфигурировать синхронизацию WAF‑ноды с Облаком, редактируя этот файл.
    
    [Подробнее о настройке синхронизации WAF‑ноды с Облаком Валарм →](configure-cloud-node-synchronization-ru.md#синхронизация-облачной-wafноды-с-облаком-валарм)

#### Подключение с использованием логина и пароля вашей учетной записи в облаке

Для того, чтобы подключить WAF‑ноду к облаку с использованием логина и пароля вашей учетной записи в облаке, выполните следующие действия:

1.  На виртуальной машине с WAF‑нодой запустите скрипт `addnode`:
    
    === "EU‑облако"
        ``` bash
        sudo /usr/share/wallarm-common/addnode
        ```
    === "RU‑облако"
        ``` bash
        sudo /usr/share/wallarm-common/addnode -H api.wallarm.ru
        ```
    
2.  Введите логин и пароль от вашего аккаунта Валарм. 

!!! info "Доступ к API"
    Виртуальная машина должна с WAF‑нодой должна иметь доступ к:

    * `https://api.wallarm.com:444` для работы с EU‑облаком
    * `https://api.wallarm.ru:444` для работы с RU‑облаком
    
    В случае проблем убедитесь, что доступ не ограничен файерволом.

Теперь WAF‑нода будет синхронизироваться с Облаком каждые 10‑15 минут в соответствии с конфигурацией синхронизации по умолчанию.

!!! info "Конфигурация синхронизации WAF‑ноды с Облаком"
    После запуска скрипта `addnode` будет создан файл `/etc/wallarm/node.yaml`, содержащий настройки синхронизации WAF‑ноды с Облаком и другие настройки для корректной работы WAF‑ноды. Вы можете изменять настройку синхронизации WAF‑ноды с Облаком, редактируя этот файл.
    
    [Подробнее о настройке синхронизации WAF‑ноды с Облаком Валарм →](configure-cloud-node-synchronization-ru.md#синхронизация-локальной-wafноды-с-облаком-валарм)
