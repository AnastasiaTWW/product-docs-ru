##   Дополнительные настройки

После установки WAF‑нода может потребовать дополнительной настройки.

Далее приводится несколько типовых настроек, которые вы можете выполнить, если это требуется.

Для получения информации о других доступных настройках, обратитесь к разделу «Настройка» [руководства администратора](../admin-ru/admin-intro-ru.md).

### Настройка отображения реального IP‑адреса клиента

Если WAF‑нода развернута за прокси‑сервером или балансировщиком нагрузки, то при такой схеме развертывания без дополнительной настройки адрес источника на WAF‑ноде может совпадать с одним из IP‑адресов прокси‑сервера или балансировщика нагрузки, а не с IP‑адресом клиента.

В этом случае, если вы хотите, чтобы на WAF‑ноду передавался IP‑адрес клиента в качестве адреса источника, то требуется [дополнительная настройка](../admin-ru/using-proxy-or-balancer-ru.md) прокси‑сервера или балансировщика.

### Добавление адресов сканера Валарм в белый список

Сканер Валарм позволяет сканировать ресурсы вашей компании на уязвимости. Сканирование происходит с IP‑адресов из этих списков:
* [адреса сканера для EU облака](../admin-ru/scanner-address-ru.md);
* [адреса сканера для RU облака](../admin-ru/scanner-address-ru-ru.md).

Если вы используете сканер Валарм, то для его корректной работы нужно настроить на средствах защиты вашего периметра (файерволы, системы предотвращения вторжений и т. д.) белые списки, содержащие в себе IP‑адреса сканера.

Например, WAF‑нода Валарм с настройками по умолчанию находится в режиме блокировки, что приводит к невозможности сканирования защищаемых нодой ресурсов с помощью сканера.

Чтобы сканировать такие ресурсы, [добавьте адреса сканера Валарм в белый список](../admin-ru/scanner-ips-whitelisting.md) этой WAF‑ноды.

### Ограничение времени обработки единичного запроса

Используйте директиву Валарм [`wallarm_process_time_limit`](../admin-ru/configure-parameters-ru.md#wallarm_process_time_limit), чтобы задать ограничение времени обработки единичного запроса WAF‑нодой.

Если запрос обрабатывается за большее время, чем указано в директиве, то в лог‑файл заносится информация об ошибке, а запрос помечается как атака `overlimit_res`.

### Ограничение времени ожидания ответа сервера

Используйте директиву NGINX [`proxy_read_timeout`](https://nginx.org/ru/docs/http/ngx_http_proxy_module.html#proxy_read_timeout), чтобы задать таймаут чтения ответа проксированного сервера. 

Если за это время сервер ничего не передаст, то соединение будет закрыто.

### Ограничение максимального размера запроса

Используйте директиву NGINX [`client_max_body_size`](https://nginx.org/ru/docs/http/ngx_http_core_module.html#client_max_body_size), чтобы задать ограничение на максимальный размер тела запроса клиента. 

В случае превышения этого ограничения NGINX вернет клиенту ответ с кодом `413` (`Payload Too Large`, также известный как `Request Entity Too Large`).