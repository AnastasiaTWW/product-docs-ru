Для обработки HTTP‑запросов Валарм использует веб‑ и прокси‑сервер NGINX с дополнительными модулями анализа трафика.

Для настройки правил проксирования и фильтрации необходимо отредактировать файлы конфигурации NGINX и WAF‑ноды Валарм:

* `/etc/nginx/nginx.conf` с настройками NGINX
* `/etc/nginx/conf.d/wallarm.conf` с глобальными настройками WAF‑ноды Валарм
* `/etc/nginx/conf.d/wallarm‑status.conf` с настройками сервиса мониторинга WAF‑ноды Валарм

Вы можете создавать свои файлы конфигурации для настройки работы NGINX и Валарм. Для каждой группы доменов, которые должны обрабатываться однотипно, принято создавать отдельный файл конфигурации, в котором присутствует блок `server`.

Подробную информацию о работе с конфигурационными файлами NGINX вы можете найти в [официальной документации NGINX](https://nginx.org/ru/docs/beginners_guide.html).

Логика работы WAF‑ноды Валарм настраивается при помощи директив Валарм. Список доступных директив Валарм доступен на странице «[Тонкая настройка](configure-parameters-ru.md)». 

#### Пример файла конфигурации

Предположим, что вам необходимо настроить сервер для работы по следующим принципам:
* обработка HTTPS‑трафика не настроена;
* запросы осуществляются к двум доменам: `example.com` и `www.example.com`;
* все запросы нужно передавать на сервер `10.80.0.5`;
* все входящие запросы меньше 1 МБ (значение по умолчанию);
* нет запросов, которые обрабатываются дольше 60 секунд (значение по умолчанию);
* система должна работать в режиме мониторинга;
* клиенты обращаются к WAF‑ноде напрямую, не через промежуточный
  HTTP‑балансировщик.

!!! info "Создание файла конфигурации"
    Вы можете создать свой файл конфигурации NGINX (например, `example.com.conf`), или модифицировать файл конфигурации NGINX, который используется по умолчанию (`default.conf`).
    
    При создании собственного файла конфигурации, убедитесь, что NGINX будет слушать входящие соединения на свободном порту.


Файл конфигурации в этом случае будет выглядеть следующим образом:

```
    server {
      listen 80;
      listen [::]:80 ipv6only=on;

      # the domains for which traffic is processed
      server_name example.com; 
      server_name www.example.com;

      # turn on the monitoring mode of traffic processing
      wallarm_mode monitoring; 

      location / {
        # setting the address for request forwarding
        proxy_pass http://10.80.0.5; 
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      }
    }

```